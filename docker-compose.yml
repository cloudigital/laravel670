version: '3'
services:
    nginx:
        image: cloudigital/nginx
        ports:
            - "6789:8001"
        networks:
            - network_laravel670
        links:
            - web_laravel670
        deploy:
            placement:
                constraints: [node.role == manager]
    web_laravel670:
        image: cloudigital/laravel670
        environment:
            - "DB_PORT=3306"
            - "DB_HOST=database"
        networks:
            - network_laravel670
        deploy:
            mode: replicated
            replicas: 4
            placement:
                constraints: [node.role == worker]
            resources:
                limits:
                    cpus: '0.1'
                    memory: 256M
    database:
        image: gmgdocker/mysql5.6
        environment:
            - "MYSQL_ROOT_PASSWORD=mysql_container_root"
            - "MYSQL_USER=cloudigital"
            - "MYSQL_PASSWORD=cloudigital@mysql"
            - "MYSQL_DATABASE=laravel670"
        ports:
            - "33061:3306"
        networks:
            - network_laravel670
        deploy:
            mode: replicated
            replicas: 1
            placement:
                constraints: [node.role == worker]

networks:
    network_laravel670:
